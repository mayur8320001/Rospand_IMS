@model Rospand_IMS.Models.VendorCreateViewModel

@{
    ViewData["Title"] = "Create Vendor";
}

<div class="card">
    <div class="card-header bg-primary text-white py-2">
        <h4 class="mb-0">Create New Vendor</h4>
    </div>
    <div class="card-body p-3">
        <form asp-action="Create" id="vendorForm">
            <div asp-validation-summary="ModelOnly" class="text-danger small"></div>

            <div class="row g-2">
                <!-- Left Column -->
                <div class="col-md-6">
                    <!-- Basic Information -->
                    <div class="form-section mb-2 p-2 border rounded">
                        <h6 class="section-title mb-2 fw-bold">Basic Information</h6>
                        <div class="row g-1">
                            <div class="col-md-6">
                                <label asp-for="VendorType" class="form-label small"></label>
                                <select asp-for="VendorType" class="form-select form-select-sm">
                                    <option value="Business">Business</option>
                                    <option value="Individual">Individual</option>
                                </select>
                                <span asp-validation-for="VendorType" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Salutation" class="form-label small"></label>
                                <select asp-for="Salutation" class="form-select form-select-sm">
                                    <option value="">-- Select --</option>
                                    <option value="Mr.">Mr.</option>
                                    <option value="Mrs.">Mrs.</option>
                                    <option value="Ms.">Ms.</option>
                                    <option value="Dr.">Dr.</option>
                                    <option value="Prof.">Prof.</option>
                                </select>
                                <span asp-validation-for="Salutation" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-6">
                                <label asp-for="FirstName" class="form-label small"></label>
                                <input asp-for="FirstName" class="form-control form-control-sm" />
                                <span asp-validation-for="FirstName" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="LastName" class="form-label small"></label>
                                <input asp-for="LastName" class="form-control form-control-sm" />
                                <span asp-validation-for="LastName" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-6">
                                <label asp-for="ContactPersonName" class="form-label small"></label>
                                <input asp-for="ContactPersonName" class="form-control form-control-sm" />
                                <span asp-validation-for="ContactPersonName" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="CompanyName" class="form-label small"></label>
                                <input asp-for="CompanyName" class="form-control form-control-sm" />
                                <span asp-validation-for="CompanyName" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-12">
                                <label asp-for="VendorDisplayName" class="form-label small"></label>
                                <input asp-for="VendorDisplayName" class="form-control form-control-sm" />
                                <span asp-validation-for="VendorDisplayName" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="form-section mb-2 p-2 border rounded">
                        <h6 class="section-title mb-2 fw-bold">Contact Information</h6>
                        <div class="row g-1">
                            <div class="col-md-6">
                                <label asp-for="VendorEmail" class="form-label small"></label>
                                <input asp-for="VendorEmail" class="form-control form-control-sm" />
                                <span asp-validation-for="VendorEmail" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="CustomerPhone" class="form-label small"></label>
                                <input asp-for="CustomerPhone" class="form-control form-control-sm" />
                                <span asp-validation-for="CustomerPhone" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-6">
                                <label asp-for="WorkPhone" class="form-label small"></label>
                                <input asp-for="WorkPhone" class="form-control form-control-sm" />
                                <span asp-validation-for="WorkPhone" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Mobile" class="form-label small"></label>
                                <input asp-for="Mobile" class="form-control form-control-sm" />
                                <span asp-validation-for="Mobile" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-6">
                    <!-- Financial Information -->
                    <div class="form-section mb-2 p-2 border rounded">
                        <h6 class="section-title mb-2 fw-bold">Financial Information</h6>
                        <div class="row g-1">
                            <div class="col-md-6">
                                <label asp-for="TaxTypeId" class="form-label small"></label>
                                <select asp-for="TaxTypeId" class="form-select form-select-sm" asp-items="ViewBag.TaxTypeId">
                                    <option value="">-- Select Tax Type --</option>
                                </select>
                                <span asp-validation-for="TaxTypeId" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="TRNNumber" class="form-label small"></label>
                                <input asp-for="TRNNumber" class="form-control form-control-sm" />
                                <span asp-validation-for="TRNNumber" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-6">
                                <label asp-for="PaymentTermId" class="form-label small"></label>
                                <select asp-for="PaymentTermId" class="form-select form-select-sm" asp-items="ViewBag.PaymentTermId">
                                    <option value="">-- Select Payment Term --</option>
                                </select>
                                <span asp-validation-for="PaymentTermId" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="CurrencyId" class="form-label small"></label>
                                <select asp-for="CurrencyId" class="form-select form-select-sm" asp-items="ViewBag.CurrencyId">
                                    <option value="">-- Select Currency --</option>
                                </select>
                                <span asp-validation-for="CurrencyId" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-12">
                                <label asp-for="OpeningBalance" class="form-label small"></label>
                                <input asp-for="OpeningBalance" class="form-control form-control-sm" />
                                <span asp-validation-for="OpeningBalance" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Address Section -->
                    <div class="form-section mb-2 p-2 border rounded">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" asp-for="ShippingSameAsBilling" id="shippingSameAsBilling" />
                            <label class="form-check-label small" for="shippingSameAsBilling">
                                Shipping address same as billing address
                            </label>
                        </div>

                        <!-- Billing Address -->
                        <h6 class="section-title mb-2 fw-bold">Billing Address</h6>
                        <div class="row g-1">
                            <div class="col-md-6">
                                <label asp-for="BillingAddress.Attention" class="form-label small"></label>
                                <input asp-for="BillingAddress.Attention" class="form-control form-control-sm" />
                                <span asp-validation-for="BillingAddress.Attention" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="BillingAddress.ContactNo" class="form-label small"></label>
                                <input asp-for="BillingAddress.ContactNo" class="form-control form-control-sm" />
                                <span asp-validation-for="BillingAddress.ContactNo" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-4">
                                <label asp-for="BillingAddress.CountryId" class="form-label small"></label>
                                <select asp-for="BillingAddress.CountryId" class="form-select form-select-sm select2" asp-items="ViewBag.CountryId" id="billingCountry">
                                    <option value="">-- Select Country --</option>
                                </select>
                                <span asp-validation-for="BillingAddress.CountryId" class="text-danger small"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="BillingAddress.StateId" class="form-label small"></label>
                                <select asp-for="BillingAddress.StateId" class="form-select form-select-sm select2" id="billingState">
                                    <option value="">-- Select State --</option>
                                </select>
                                <span asp-validation-for="BillingAddress.StateId" class="text-danger small"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="BillingAddress.CityId" class="form-label small"></label>
                                <select asp-for="BillingAddress.CityId" class="form-select form-select-sm select2" id="billingCity">
                                    <option value="">-- Select City --</option>
                                </select>
                                <span asp-validation-for="BillingAddress.CityId" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-md-6">
                                <label asp-for="BillingAddress.ZipCode" class="form-label small"></label>
                                <input asp-for="BillingAddress.ZipCode" class="form-control form-control-sm" />
                                <span asp-validation-for="BillingAddress.ZipCode" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="row g-1 mt-1">
                            <div class="col-12">
                                <label asp-for="BillingAddress.StreetAddress" class="form-label small"></label>
                                <textarea asp-for="BillingAddress.StreetAddress" class="form-control form-control-sm" rows="2"></textarea>
                                <span asp-validation-for="BillingAddress.StreetAddress" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Shipping Address -->
                        <div id="shippingAddressSection">
                            <h6 class="section-title mt-2 mb-2 fw-bold">Shipping Address</h6>
                            <div class="row g-1">
                                <div class="col-md-6">
                                    <label asp-for="ShippingAddress.Attention" class="form-label small"></label>
                                    <input asp-for="ShippingAddress.Attention" class="form-control form-control-sm" />
                                    <span asp-validation-for="ShippingAddress.Attention" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="ShippingAddress.ContactNo" class="form-label small"></label>
                                    <input asp-for="ShippingAddress.ContactNo" class="form-control form-control-sm" />
                                    <span asp-validation-for="ShippingAddress.ContactNo" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="row g-1 mt-1">
                                <div class="col-md-4">
                                    <label asp-for="ShippingAddress.CountryId" class="form-label small"></label>
                                    <select asp-for="ShippingAddress.CountryId" class="form-select form-select-sm select2" asp-items="ViewBag.CountryId" id="shippingCountry">
                                        <option value="">-- Select Country --</option>
                                    </select>
                                    <span asp-validation-for="ShippingAddress.CountryId" class="text-danger small"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="ShippingAddress.StateId" class="form-label small"></label>
                                    <select asp-for="ShippingAddress.StateId" class="form-select form-select-sm select2" id="shippingState">
                                        <option value="">-- Select State --</option>
                                    </select>
                                    <span asp-validation-for="ShippingAddress.StateId" class="text-danger small"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="ShippingAddress.CityId" class="form-label small"></label>
                                    <select asp-for="ShippingAddress.CityId" class="form-select form-select-sm select2" id="shippingCity">
                                        <option value="">-- Select City --</option>
                                    </select>
                                    <span asp-validation-for="ShippingAddress.CityId" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="row g-1 mt-1">
                                <div class="col-md-6">
                                    <label asp-for="ShippingAddress.ZipCode" class="form-label small"></label>
                                    <input asp-for="ShippingAddress.ZipCode" class="form-control form-control-sm" />
                                    <span asp-validation-for="ShippingAddress.ZipCode" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="row g-1 mt-1">
                                <div class="col-12">
                                    <label asp-for="ShippingAddress.StreetAddress" class="form-label small"></label>
                                    <textarea asp-for="ShippingAddress.StreetAddress" class="form-control form-control-sm" rows="2"></textarea>
                                    <span asp-validation-for="ShippingAddress.StreetAddress" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-end mt-3 border-top pt-2">
                <button type="submit" class="btn btn-primary btn-sm me-2">Create Vendor</button>
                <a asp-action="Index" class="btn btn-secondary btn-sm">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container .select2-selection--single {
            height: 31px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 31px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 29px !important;
        }

        .select2-container--default .select2-selection--single {
            border: 1px solid #ced4da !important;
            border-radius: 0.25rem !important;
        }

        .select2-container {
            width: 100% !important;
        }

        .select2-dropdown {
            z-index: 1055 !important;
        }
    </style>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2 for all select elements with class 'select2'
            $('.select2').select2({
                width: 'resolve',
                placeholder: "Select an option",
                allowClear: true
            });

            // Toggle shipping address visibility
            function toggleShippingAddress() {
                if ($('#shippingSameAsBilling').is(':checked')) {
                    $('#shippingAddressSection').hide();
                } else {
                    $('#shippingAddressSection').show();
                }
            }

            // Initial toggle
            toggleShippingAddress();

            // Bind change event
            $('#shippingSameAsBilling').change(toggleShippingAddress);

            // Cascade dropdowns for billing address
            $('#billingCountry').change(function() {
                var countryId = $(this).val();
                $('#billingState').empty().append('<option value="">-- Select State --</option>');
                $('#billingCity').empty().append('<option value="">-- Select City --</option>');
                $('#billingState').val('').trigger('change');
                $('#billingCity').val('').trigger('change');

                if (countryId) {
                    $.getJSON('/Vendor/GetStatesByCountry', { countryId: countryId }, function(data) {
                        $.each(data, function(index, item) {
                            $('#billingState').append($('<option></option>').val(item.id).text(item.name));
                        });
                    });
                }
            });

            $('#billingState').change(function() {
                var stateId = $(this).val();
                $('#billingCity').empty().append('<option value="">-- Select City --</option>');
                $('#billingCity').val('').trigger('change');

                if (stateId) {
                    $.getJSON('/Vendor/GetCitiesByState', { stateId: stateId }, function(data) {
                        $.each(data, function(index, item) {
                            $('#billingCity').append($('<option></option>').val(item.id).text(item.name));
                        });
                    });
                }
            });

            // Cascade dropdowns for shipping address
            $('#shippingCountry').change(function() {
                var countryId = $(this).val();
                $('#shippingState').empty().append('<option value="">-- Select State --</option>');
                $('#shippingCity').empty().append('<option value="">-- Select City --</option>');
                $('#shippingState').val('').trigger('change');
                $('#shippingCity').val('').trigger('change');

                if (countryId) {
                    $.getJSON('/Vendor/GetStatesByCountry', { countryId: countryId }, function(data) {
                        $.each(data, function(index, item) {
                            $('#shippingState').append($('<option></option>').val(item.id).text(item.name));
                        });
                    });
                }
            });

            $('#shippingState').change(function() {
                var stateId = $(this).val();
                $('#shippingCity').empty().append('<option value="">-- Select City --</option>');
                $('#shippingCity').val('').trigger('change');

                if (stateId) {
                    $.getJSON('/Vendor/GetCitiesByState', { stateId: stateId }, function(data) {
                        $.each(data, function(index, item) {
                            $('#shippingCity').append($('<option></option>').val(item.id).text(item.name));
                        });
                    });
                }
            });
        });
    </script>
}